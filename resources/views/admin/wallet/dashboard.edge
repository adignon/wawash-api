@layout.admin({ title: 'Wallet', pageTitle: 'Wallet Dashboard' })

@slot('topbarActions')
  <a href="{{ route('admin.wallet.withdraw') }}" class="btn btn-primary">
    <span>ğŸ’¸</span>
    <span>Withdraw</span>
  </a>
  <a href="{{ route('admin.wallet.transactions') }}" class="btn btn-secondary">
    <span>ğŸ“‹</span>
    <span>Transactions</span>
  </a>
@end

@slot('main')
  <style>
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 16px;
      padding: 24px;
      color: white;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    }

    .chart-container {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .chart-bar {
      transition: all 0.3s ease;
    }

    .chart-bar:hover {
      opacity: 0.8;
      transform: translateY(-2px);
    }

    .transaction-item {
      transition: all 0.2s ease;
    }

    .transaction-item:hover {
      background: #f9fafb;
      transform: translateX(4px);
    }
  </style>

  {{-- Key Wallet Statistics --}}
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; margin-bottom: 32px;">
    {{-- Total Volume --}}
    <div class="stat-card" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
      <div style="position: relative; z-index: 1;">
        <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px; font-weight: 500;">ğŸ“Š Total Volume</div>
        <div style="font-size: 36px; font-weight: 700; margin-bottom: 4px;">
          {{ totalVolume }}
        </div>
        <div style="font-size: 14px; opacity: 0.8;">FCFA (All Invoices)</div>
      </div>
    </div>

    {{-- Total Revenues --}}
    <div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
      <div style="position: relative; z-index: 1;">
        <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px; font-weight: 500;">ğŸ’ Total Revenues</div>
        <div style="font-size: 36px; font-weight: 700; margin-bottom: 4px;">
          {{ totalRevenues }}
        </div>
        <div style="font-size: 14px; opacity: 0.8;">FCFA (Margins)</div>
      </div>
    </div>

    {{-- Total Withdrawals --}}
    <div class="stat-card" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
      <div style="position: relative; z-index: 1;">
        <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px; font-weight: 500;">ğŸ’¸ Total Withdrawals</div>
        <div style="font-size: 36px; font-weight: 700; margin-bottom: 4px;">
          {{ totalWithdrawals }}
        </div>
        <div style="font-size: 14px; opacity: 0.8;">FCFA (Transfers)</div>
      </div>
    </div>

    {{-- Payment Accounts Balance --}}
    <div class="stat-card" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
      <div style="position: relative; z-index: 1;">
        <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px; font-weight: 500;">ğŸ¦ Balance Total</div>
        <div style="font-size: 36px; font-weight: 700; margin-bottom: 4px;">
          {{ paymentAccountsBalance }}
        </div>
        <div style="font-size: 14px; opacity: 0.8;">FCFA (Available)</div>
        <div style="font-size: 11px; opacity: 0.7; margin-top: 8px;">
          â„ï¸ Frozen: {{ paymentAccountsFrozenBalance }} FCFA
        </div>
      </div>
    </div>
  </div>

  {{-- Merchant Balance Overview Cards --}}
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; margin-bottom: 32px;">
    {{-- Total Merchant Balance --}}
    <div class="stat-card">
      <div style="position: relative; z-index: 1;">
        <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px; font-weight: 500;">ğŸ’° Merchant Balance</div>
        <div style="font-size: 36px; font-weight: 700; margin-bottom: 4px;">
          {{ totalBalance }}
        </div>
        <div style="font-size: 14px; opacity: 0.8;">FCFA</div>
      </div>
    </div>

    {{-- Available Merchant Balance --}}
    <div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
      <div style="position: relative; z-index: 1;">
        <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px; font-weight: 500;">âœ… Available</div>
        <div style="font-size: 36px; font-weight: 700; margin-bottom: 4px;">
          {{ availableBalance }}
        </div>
        <div style="font-size: 14px; opacity: 0.8;">FCFA</div>
      </div>
    </div>
  </div>

  {{-- Income Analytics Cards --}}
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 32px;">
    {{-- Monthly Income --}}
    <div class="chart-container">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
        <div style="font-size: 14px; color: #6b7280; font-weight: 600;">ğŸ“… This Month</div>
        <div style="font-size: 32px;">ğŸ“ˆ</div>
      </div>
      <div style="font-size: 28px; font-weight: 700; color: #1f2937; margin-bottom: 4px;">
        {{ monthlyIncome }}
      </div>
      <div style="font-size: 13px; color: #6b7280;">FCFA earned</div>
    </div>

    {{-- Weekly Income --}}
    <div class="chart-container">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
        <div style="font-size: 14px; color: #6b7280; font-weight: 600;">ğŸ“† Last 7 Days</div>
        <div style="font-size: 32px;">ğŸ’¹</div>
      </div>
      <div style="font-size: 28px; font-weight: 700; color: #1f2937; margin-bottom: 4px;">
        {{ weeklyIncome }}
      </div>
      <div style="font-size: 13px; color: #6b7280;">FCFA earned</div>
    </div>

    {{-- Daily Average --}}
    <div class="chart-container">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
        <div style="font-size: 14px; color: #6b7280; font-weight: 600;">ğŸ“Š Daily Average</div>
        <div style="font-size: 32px;">âš¡</div>
      </div>
      <div style="font-size: 28px; font-weight: 700; color: #1f2937; margin-bottom: 4px;">
        {{ dailyAverage }}
      </div>
      <div style="font-size: 13px; color: #6b7280;">FCFA per day</div>
    </div>

    {{-- Total Income --}}
    <div class="chart-container">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
        <div style="font-size: 14px; color: #6b7280; font-weight: 600;">ğŸ’ Total Income</div>
        <div style="font-size: 32px;">ğŸ¯</div>
      </div>
      <div style="font-size: 28px; font-weight: 700; color: #1f2937; margin-bottom: 4px;">
        {{ totalIncome }}
      </div>
      <div style="font-size: 13px; color: #6b7280;">From {{ completedOrdersCount }} orders</div>
    </div>
  </div>

  {{-- 7-Day Income Chart --}}
  <div class="chart-container" style="margin-bottom: 32px;">
    <h3 style="font-size: 18px; font-weight: 700; color: #1f2937; margin-bottom: 20px;">
      ğŸ“Š Last 7 Days Income
    </h3>

    <div style="display: flex; align-items: flex-end; justify-content: space-between; height: 200px; gap: 8px; padding: 0 8px;">
      @each(day in last7Days)
        @let(barHeight = maxIncome > 0 ? (day.income / maxIncome * 100) : 0)
        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;">
          <div class="chart-bar" style="width: 100%; background: linear-gradient(to top, #667eea, #764ba2); border-radius: 8px 8px 0 0; position: relative; height: {{ barHeight }}%; min-height: 8px; cursor: pointer;" title="{{ day.incomeFormatted }} FCFA - {{ day.orders }} orders">
            <div style="position: absolute; top: -24px; left: 50%; transform: translateX(-50%); font-size: 11px; font-weight: 600; color: #374151; white-space: nowrap;">
              {{ day.income > 0 ? day.incomeFormatted : '' }}
            </div>
          </div>
          <div style="margin-top: 8px; font-size: 12px; color: #6b7280; font-weight: 500;">{{ day.date }}</div>
          <div style="font-size: 10px; color: #9ca3af;">{{ day.orders }} orders</div>
        </div>
      @end
    </div>
  </div>

  {{-- Recent Withdrawals --}}
  <div class="chart-container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h3 style="font-size: 18px; font-weight: 700; color: #1f2937; margin: 0;">
        ğŸ’¸ Recent Withdrawals
      </h3>
      <a href="{{ route('admin.wallet.transactions') }}" style="color: #667eea; font-size: 14px; font-weight: 600; text-decoration: none;">
        View All â†’
      </a>
    </div>

    @if(recentPayments.length > 0)
      <div style="border: 1px solid #e5e7eb; border-radius: 12px; overflow: hidden;">
        @each(payment in recentPayments)
          <div class="transaction-item" style="padding: 16px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; align-items: center; gap: 16px;">
              <div style="width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;
                {{ payment.status === 'SUCCESS' ? 'background: #d1fae5;' : payment.status === 'PENDING' ? 'background: #fef3c7;' : payment.status === 'FAILED' ? 'background: #fee2e2;' : 'background: #e5e7eb;' }}">
                {{ payment.status === 'SUCCESS' ? 'âœ…' : payment.status === 'PENDING' ? 'â³' : payment.status === 'FAILED' ? 'âŒ' : 'ğŸ“„' }}
              </div>
              <div>
                <div style="font-weight: 600; color: #1f2937; margin-bottom: 2px;">
                  {{ payment.paymentHash || 'N/A' }}
                </div>
                <div style="font-size: 13px; color: #6b7280;">
                  {{ payment.createdAtFormatted }}
                </div>
                @if(payment.comment)
                  <div style="font-size: 12px; color: #9ca3af; margin-top: 2px;">
                    {{ payment.comment }}
                  </div>
                @end
              </div>
            </div>
            <div style="text-align: right;">
              <div style="font-weight: 700; font-size: 18px; color: #ef4444; margin-bottom: 2px;">
                -{{ payment.askAmountFormatted }} FCFA
              </div>
              <div>
                @if(payment.status === 'SUCCESS')
                  <span style="background: #d1fae5; color: #065f46; padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 600;">
                    SUCCESS
                  </span>
                @elseif(payment.status === 'PENDING')
                  <span style="background: #fef3c7; color: #92400e; padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 600;">
                    PENDING
                  </span>
                @elseif(payment.status === 'FAILED')
                  <span style="background: #fee2e2; color: #991b1b; padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 600;">
                    FAILED
                  </span>
                @else
                  <span style="background: #e5e7eb; color: #374151; padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 600;">
                    {{ payment.status }}
                  </span>
                @end
              </div>
            </div>
          </div>
        @end
      </div>
    @else
      <div style="padding: 60px 20px; text-align: center; color: #6b7280;">
        <div style="font-size: 48px; margin-bottom: 16px;">ğŸ’¸</div>
        <p style="font-size: 15px; margin: 0;">No withdrawals yet</p>
        <p style="font-size: 13px; margin: 8px 0 0 0;">
          <a href="{{ route('admin.wallet.withdraw') }}" style="color: #667eea;">Create withdrawal</a>
        </p>
      </div>
    @end
  </div>
@end
@end
