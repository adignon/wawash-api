@layout.admin({ title: 'Users', pageTitle: 'User Management' })

@slot('topbarActions')
  <a href="{{ route('admin.users.create') }}" class="btn btn-primary">
    <span>+</span>
    <span>Add User</span>
  </a>
@end

@slot('main')
  {{-- Search Bar --}}
  <div class="card" style="margin-bottom: 24px;">
    <form action="{{ route('admin.users.index') }}" method="GET" style="padding: 0;">
      <div style="display: flex; gap: 12px; align-items: center;">
        <div style="flex: 1; position: relative;">
          <input
            type="text"
            name="search"
            value="{{ search || '' }}"
            placeholder="Search by name, email, or phone..."
            style="width: 100%; padding: 12px 40px 12px 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; outline: none;"
            onfocus="this.style.borderColor='#667eea'"
            onblur="this.style.borderColor='#e5e7eb'"
          >
          @if(search)
            <a
              href="{{ route('admin.users.index') }}"
              style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: #6b7280; text-decoration: none; font-size: 20px;"
              title="Clear search"
            >Ã—</a>
          @end
        </div>
        <button type="submit" class="btn btn-primary">Search</button>
      </div>
    </form>
  </div>

  {{-- Users Table --}}
  <div class="card">
    <div class="card-header">
      <h2 class="card-title">Users ({{ users.length }})</h2>
    </div>

    @if(users.length > 0)
      <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr style="border-bottom: 2px solid #e5e7eb; background: #f9fafb;">
              <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #6b7280; text-transform: uppercase;">User</th>
              <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #6b7280; text-transform: uppercase;">Contact</th>
              <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #6b7280; text-transform: uppercase;">Role</th>
              <th style="padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #6b7280; text-transform: uppercase;">Merchant</th>
              <th style="padding: 12px 16px; text-align: right; font-size: 13px; font-weight: 600; color: #6b7280; text-transform: uppercase;">Actions</th>
            </tr>
          </thead>
          <tbody>
            @each(user in users)
              <tr style="border-bottom: 1px solid #e5e7eb;">
                <td style="padding: 16px;">
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;">
                      @if(user.firstname)
                        {{ user.firstname.charAt(0).toUpperCase() }}
                      @elseif(user.lastname)
                        {{ user.lastname.charAt(0).toUpperCase() }}
                      @else
                        ?
                      @end
                    </div>
                    <div>
                      <div style="font-weight: 600; color: #1f2937;">
                        {{ user.firstname || '' }} {{ user.lastname || '' }}
                        @if(!user.firstname && !user.lastname)
                          <span style="color: #9ca3af;">No name</span>
                        @end
                      </div>
                      <div style="font-size: 12px; color: #6b7280;">
                        ID: {{ user.id }}
                      </div>
                    </div>
                  </div>
                </td>
                <td style="padding: 16px;">
                  <div style="font-size: 13px;">
                    @if(user.email)
                      <div style="color: #374151; margin-bottom: 4px;">
                        ğŸ“§ {{ user.email }}
                      </div>
                    @end
                    @if(user.phone)
                      <div style="color: #374151; font-family: monospace;">
                        ğŸ“± {{ user.phone }}
                      </div>
                    @end
                    @if(!user.email && !user.phone)
                      <span style="color: #9ca3af;">No contact</span>
                    @end
                  </div>
                </td>
                <td style="padding: 16px;">
                  @if(user.role === 'ADMIN')
                    <span style="background: #fef3c7; color: #92400e; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                      ğŸ‘‘ ADMIN
                    </span>
                  @elseif(user.role === 'CLEANER')
                    <span style="background: #dbeafe; color: #1e40af; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                      ğŸ§¹ CLEANER
                    </span>
                  @else
                    <span style="background: #d1fae5; color: #065f46; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                      ğŸ‘¤ CLIENT
                    </span>
                  @end
                </td>
                <td style="padding: 16px;">
                  @if(user.merchantId)
                    <span style="font-size: 13px; color: #374151;">
                      ğŸª Merchant #{{ user.merchantId }}
                    </span>
                  @else
                    <span style="color: #9ca3af; font-size: 13px;">â€”</span>
                  @end
                </td>
                <td style="padding: 16px; text-align: right;">
                  <div style="display: flex; gap: 8px; justify-content: flex-end;">
                    <a href="{{ route('admin.users.edit', { id: user.id }) }}" class="btn btn-sm btn-secondary">
                      Edit
                    </a>
                    <form action="{{ route('admin.users.delete', { id: user.id }) }}"
                          method="POST"
                          onsubmit="return confirm('Are you sure you want to delete this user?')"
                          style="margin: 0;">
                      <button type="submit" class="btn btn-sm btn-danger" style="background: #ef4444; border-color: #ef4444;">
                        Delete
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
            @end
          </tbody>
        </table>
      </div>
    @else
      <div style="padding: 60px 20px; text-align: center; color: #6b7280;">
        <div style="font-size: 48px; margin-bottom: 16px;">ğŸ‘¥</div>
        @if(search)
          <p style="font-size: 15px; margin: 0;">No users found matching "{{ search }}"</p>
          <p style="font-size: 13px; margin: 8px 0 0 0;">
            <a href="{{ route('admin.users.index') }}" style="color: #667eea;">Clear search</a>
          </p>
        @else
          <p style="font-size: 15px; margin: 0;">No users yet</p>
          <p style="font-size: 13px; margin: 8px 0 0 0;">Click "Add User" to create a new user</p>
        @end
      </div>
    @end
  </div>
@end
@end
